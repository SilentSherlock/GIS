<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!--bootstrap针对移动设备优化，设置页面宽度和初始缩放-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>管理界面</title>
    <!--引入bootstrap文件-->
    <link rel="stylesheet" href="../static/extlib/bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" href="../static/extlib/bootstrap-3.3.7/css/bootstrap-theme.css">
    <!--js插件引用-->
    <script type="text/javascript" src="../static/extlib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../static/extlib/bootstrap-3.3.7/js/bootstrap.js"></script>

    <!--引入echarts-->
    <script type="text/javascript" src="../static/extlib/echarts/echarts.js"></script>
    <style rel="stylesheet">
        body {
            padding-top: 70px;
        }
        .chartShow-row {

        }
        .chart-show-leaf-chart {
            width: inherit;
            height: 500px;
        }
    </style>
    <!--获取图表-->
    <script type="text/javascript">
        $(document).ready(function () {
            let cornLeafData = getChartData("corn/cornLeafTRT", JSON.stringify({TRT: "1.1"}), 1);
            alert(cornLeafData);
            let extractData = extractAll(cornLeafData);//待完成
            let cornLeafOption = {
                legend: {},
                tooltip: {},
                xAxis: {type: "category"},
                yAxis: {},
                dataset: {
                    source: extractData
                },
                series: [
                    {
                        type: "line",
                        name: "LeafPerimeter",
                        encode: {
                            x: 0,
                            y: 3
                        }
                    },
                    {
                        type: "line",
                        name: "LeafArea",
                        encode: {
                            x: 0,
                            y: 1
                        }
                    },
                    {
                        type: "line",
                        name: "LeafNumber",
                        encode: {
                            x: 0,
                            y: 2
                        }
                    }
                ]
            };
            let cornLeafChart = getAndInitChart("chart-show-leaf-chart");
            cornLeafChart.setOption(cornLeafOption)
        });

        /*初始化图表节点*/
        function getAndInitChart(chartDomId, theme = "dark") {
            let chartDom = document.getElementById(chartDomId);
            return echarts.init(chartDom, theme)
        }

        /*向后台发送请求获取数据*/
        function getChartData(requestUrl, jsonStr, flag = 0) {
            let chartData = [];
            if (requestUrl != null && flag === 1) {
                $.ajax({
                    url: requestUrl,
                    type: "post",
                    data: jsonStr,
                    dataType: "text",
                    contentType: "application/json;charset=UTF-8",
                    async: false,
                    success: data => {
                        if (data === "0"){
                            alert("获取图表数据失败");
                        }else {
                            alert(data);
                            chartData = JSON.parse(data);
                        }
                    }
                })
            }else if(requestUrl != null && flag === 0){
                $.ajax({
                    url: requestUrl,
                    type: "post",
                    contentType: "application/json;charset=UTF-8",
                    async: false,
                    success: data => {
                        if (data === "0"){//获取数据失败
                            alert("图表数据获取失败");
                        }else {
                            alert(data);
                            chartData = JSON.parse(data);
                        }
                    }
                })
            }

            return chartData?chartData:null;
        }

        /*提取JSON数组对象中的某一列数据*/
        function extractCol(chartData, colName) {
            let colData = [];
            for (let row = 0;row < chartData.length;row++){
                colData.push(chartData[row][colName]);
            }
            return colData
        }

        /*提取JSON数组对象中所有数据*/
        function extractAll(chartData) {
            let allData = [];
            alert(chartData);
            for (let row = 0;row < chartData.length ;row++){
                let rowData = [];
                for (let x in chartData[row]){
                    rowData.push(chartData[row][x]);
                }
                allData.push(rowData);
            }
            return allData;
        }
    </script>
</head>
<body>
<!--导航条-->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">Brand</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#">首页</a></li>
                <li><a href="#">地图</a></li>
                <li><a href="#">图表</a></li>
                <li class="dropdown">
                    <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">其他<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">新建用户</a></li>
                        <li><a href="#">添加数据</a></li>
                    </ul>
                </li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">用户名<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">用户信息</a></li>
                        <li><a href="#">退出登录</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="chartShow-row container-fluid row">
    <!--左侧竖直导航栏-->
    <div class="col-md-2 chart-kind-nav">
        <nav>
            <ul class="nav nav-pills nav-stacked">
                <li role="presentation"><a href="#">玉米作物</a></li>
                <li role="presentation"><a href="#">气象相关</a></li>
                <li role="presentation"><a href="#">土壤相关</a></li>
            </ul>
        </nav>
    </div>
    <!--右侧图表区域-->
    <div class="col-md-10 chart-show">
        <!--玉米株高和叶绿素-->
        <div class="row chart-show-cornHandCh" id="chart-show-cornHandCh">
        </div>
        <!--玉米叶-->
        <div class="row chart-show-leaf">
            <h3>玉米叶相关</h3><hr>
            <div class="col-md-12 chart-show-leaf-chart" id="chart-show-leaf-chart"></div>
            <!--<button class="btn btn-block" id="testButton">Test</button>-->
        </div>
        <!--玉米产量-->
        <div class="row chart-show-yield" id="chart-show-yield"></div>
        <div id="testChart" style="width: 600px; height: 400px"></div>
    </div>

</div>


<script type="text/javascript">
    $(document).ready(function () {
        $("#testButton").click(function () {
            getChartData("corn/cornLeafTRT", JSON.stringify({TRT:"1.1"}), 1);
        })
    });


    let testChart = getAndInitChart("testChart");
    let chartData = [345, 383, 897, 645, 244, 989, 235];
    testChart.setOption({
        legend: {},
        tooltip: {},
        xAxis: {
            type: "category",
            data: [
                "Mon", "Tue", "Wed", "Thu", "Fri", "Sta", "Sun"
            ]
        },
        yAxis: {},
        series: [
            {
                type: "bar",
                data: chartData
            },
            {
                type: "line",
                data: chartData
            }
        ]
    })
</script>
</body>
</html>